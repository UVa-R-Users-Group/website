<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="generator" content="Hugo 0.30.2" />

  <title>Kickoff Meetup: dplyr demo &middot; Cville R users</title>

  
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/pure-min.css">

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-old-ie-min.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pure/1.0.0/grids-responsive-min.css">
  <!--<![endif]-->

  <!--[if lte IE 8]>
  <link rel="stylesheet" href="/css/side-menu-old-ie.css">
  <![endif]-->
  <!--[if gt IE 8]><!-->
  <link rel="stylesheet" href="/css/side-menu.css">
  <!--<![endif]-->

  <link rel="stylesheet" href="/css/blackburn.css">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

  
  <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

 
  

  
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/androidstudio.min.css">
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  
  <script>hljs.initHighlightingOnLoad();</script>
  

  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />

  
  

</head>


<body>
<div id="layout">

  
<a href="#menu" id="menuLink" class="menu-link">
  
  <span></span>
</a>
<div id="menu">

  
  <a class="pure-menu-heading brand" href="/">Cville UseRs</a>


  <div class="pure-menu">
    <ul class="pure-menu-list">
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/"><i class='fa fa-home fa-fw'></i>Home</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/about/"><i class='fa fa-user fa-fw'></i>About CvilleRs</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/post/"><i class='fa fa-list fa-fw'></i>Archives</a>
      
        </li>
      
      
        <li class="pure-menu-item">
          <a class="pure-menu-link" href="/projects/"><i class='fa fa-wrench fa-fw'></i>Projects</a>
      
        </li>
      
    </ul>
  </div>

  <div class="pure-menu social">
  <ul class="pure-menu-list">

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
    <li class="pure-menu-item">
      <a class="pure-menu-link" href="https://github.com/UVa-R-Users-Group" target="_blank"><i class="fa fa-github-square fa-fw"></i>GitHub</a>
    </li>
    

    

    

    

    

    

    

    

    

    

    

    

    

  </ul>
</div>


  <div>
  <div class="small-print">
    <small>&copy; 2018. All rights reserved.</small>
  </div>
  <div class="small-print">
    <small>Built with&nbsp;<a href="https://gohugo.io/" target="_blank">Hugo</a></small>
    <small>Theme&nbsp;<a href="https://github.com/yoshiharuyamashita/blackburn" target="_blank">Blackburn</a></small>
  </div>
</div>

</div>


  <div id="main">


<div class="header">
  <h1>Kickoff Meetup: dplyr demo</h1>
  <h2></h2>
</div>
<div class="content">

  <div class="post-meta">

  <div>
    <i class="fa fa-calendar fa-fw"></i>
    <time>08 Sep 2014</time>
  </div>

  

  

  
  
  
  <div>
    <i class="fa fa-tags fa-fw"></i>
    
      <a class="post-taxonomy-tag" href="/tags/dplyr">dplyr</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/lubridate">lubridate</a>&nbsp;&#47;
    
      <a class="post-taxonomy-tag" href="/tags/ggplot2">ggplot2</a>
    
  </div>
  
  

</div>

  <p>This is an R script ported from <a href="https://github.com/UVa-R-Users-Group/meetup/blob/master/2014-09-08-kickoff-meetup-dplyr-demo/dplyr-nycflights13.R">here</a>.</p>
<pre class="r"><code># Load packages
library(&quot;dplyr&quot;)
library(&quot;ggplot2&quot;)
library(&quot;nycflights13&quot;)
library(&quot;lubridate&quot;)</code></pre>
<pre class="r"><code># it&#39;s a data.frame, but also a tbl_df.
# doesn&#39;t print entire thing to screen.
flights</code></pre>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code>class(flights)</code></pre>
<pre><code>## [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</code></pre>
<pre class="r"><code>weather</code></pre>
<pre><code>## # A tibble: 26,130 x 15
##    origin  year month   day  hour  temp  dewp humid wind_dir wind_speed
##     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
##  1    EWR  2013     1     1     0 37.04 21.92 53.97      230   10.35702
##  2    EWR  2013     1     1     1 37.04 21.92 53.97      230   13.80936
##  3    EWR  2013     1     1     2 37.94 21.92 52.09      230   12.65858
##  4    EWR  2013     1     1     3 37.94 23.00 54.51      230   13.80936
##  5    EWR  2013     1     1     4 37.94 24.08 57.04      240   14.96014
##  6    EWR  2013     1     1     6 39.02 26.06 59.37      270   10.35702
##  7    EWR  2013     1     1     7 39.02 26.96 61.63      250    8.05546
##  8    EWR  2013     1     1     8 39.02 28.04 64.43      240   11.50780
##  9    EWR  2013     1     1     9 39.92 28.04 62.21      250   12.65858
## 10    EWR  2013     1     1    10 39.02 28.04 64.43      260   12.65858
## # ... with 26,120 more rows, and 5 more variables: wind_gust &lt;dbl&gt;,
## #   precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code>planes</code></pre>
<pre><code>## # A tibble: 3,322 x 9
##    tailnum  year                    type     manufacturer     model
##      &lt;chr&gt; &lt;int&gt;                   &lt;chr&gt;            &lt;chr&gt;     &lt;chr&gt;
##  1  N10156  2004 Fixed wing multi engine          EMBRAER EMB-145XR
##  2  N102UW  1998 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  3  N103US  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  4  N104UW  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  5  N10575  2002 Fixed wing multi engine          EMBRAER EMB-145LR
##  6  N105UW  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  7  N107US  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  8  N108UW  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  9  N109UW  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
## 10  N110UW  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
## # ... with 3,312 more rows, and 4 more variables: engines &lt;int&gt;,
## #   seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</code></pre>
<pre class="r"><code>airports</code></pre>
<pre><code>## # A tibble: 1,458 x 8
##      faa                           name      lat        lon   alt    tz
##    &lt;chr&gt;                          &lt;chr&gt;    &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
##  1   04G              Lansdowne Airport 41.13047  -80.61958  1044    -5
##  2   06A  Moton Field Municipal Airport 32.46057  -85.68003   264    -6
##  3   06C            Schaumburg Regional 41.98934  -88.10124   801    -6
##  4   06N                Randall Airport 41.43191  -74.39156   523    -5
##  5   09J          Jekyll Island Airport 31.07447  -81.42778    11    -5
##  6   0A9 Elizabethton Municipal Airport 36.37122  -82.17342  1593    -5
##  7   0G6        Williams County Airport 41.46731  -84.50678   730    -5
##  8   0G7  Finger Lakes Regional Airport 42.88356  -76.78123   492    -5
##  9   0P2   Shoestring Aviation Airfield 39.79482  -76.64719  1000    -5
## 10   0S9          Jefferson County Intl 48.05381 -122.81064   108    -8
## # ... with 1,448 more rows, and 2 more variables: dst &lt;chr&gt;, tzone &lt;chr&gt;</code></pre>
<pre class="r"><code>airlines</code></pre>
<pre><code>## # A tibble: 16 x 2
##    carrier                        name
##      &lt;chr&gt;                       &lt;chr&gt;
##  1      9E           Endeavor Air Inc.
##  2      AA      American Airlines Inc.
##  3      AS        Alaska Airlines Inc.
##  4      B6             JetBlue Airways
##  5      DL        Delta Air Lines Inc.
##  6      EV    ExpressJet Airlines Inc.
##  7      F9      Frontier Airlines Inc.
##  8      FL AirTran Airways Corporation
##  9      HA      Hawaiian Airlines Inc.
## 10      MQ                   Envoy Air
## 11      OO       SkyWest Airlines Inc.
## 12      UA       United Air Lines Inc.
## 13      US             US Airways Inc.
## 14      VX              Virgin America
## 15      WN      Southwest Airlines Co.
## 16      YV          Mesa Airlines Inc.</code></pre>
<pre class="r"><code># dplyr also gives you verbs. All take a tbl_df as first argument.
# on their own, not much that base R can&#39;t do.
## select particular variables from flights
select(flights, year, month, day)</code></pre>
<pre><code>## # A tibble: 336,776 x 3
##     year month   day
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1  2013     1     1
##  2  2013     1     1
##  3  2013     1     1
##  4  2013     1     1
##  5  2013     1     1
##  6  2013     1     1
##  7  2013     1     1
##  8  2013     1     1
##  9  2013     1     1
## 10  2013     1     1
## # ... with 336,766 more rows</code></pre>
<pre class="r"><code>## filter based on some condition. all fights taken by this plane.
filter(flights, tailnum==&quot;N14228&quot;)</code></pre>
<pre><code>## # A tibble: 111 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     8     1435           1440        -5     1717
##  3  2013     1     9      717            700        17      812
##  4  2013     1     9     1143           1144        -1     1425
##  5  2013     1    13      835            824        11     1030
##  6  2013     1    16     1829           1730        59     2117
##  7  2013     1    22     1902           1808        54     2214
##  8  2013     1    23     1050           1056        -6     1143
##  9  2013     1    23     1533           1529         4     1641
## 10  2013     1    25      724            720         4     1000
## # ... with 101 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code>## mutate adds new columns. time made up in air:
mutate(flights, madeup=dep_delay-arr_delay)</code></pre>
<pre><code>## # A tibble: 336,776 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, madeup &lt;dbl&gt;</code></pre>
<pre class="r"><code>## summarize reduces grouped data to a single row.
summarize(flights, avgdelay=mean(arr_delay, na.rm=TRUE))</code></pre>
<pre><code>## # A tibble: 1 x 1
##   avgdelay
##      &lt;dbl&gt;
## 1 6.895377</code></pre>
<pre class="r"><code>## group_by turns existing table into grouped_df class
## summary operations are performed by the group
group_by(flights, dest)</code></pre>
<pre><code>## # A tibble: 336,776 x 19
## # Groups:   dest [105]
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code>summarize(group_by(flights, dest), avgdelay=mean(arr_delay, na.rm=TRUE))</code></pre>
<pre><code>## # A tibble: 105 x 2
##     dest  avgdelay
##    &lt;chr&gt;     &lt;dbl&gt;
##  1   ABQ  4.381890
##  2   ACK  4.852273
##  3   ALB 14.397129
##  4   ANC -2.500000
##  5   ATL 11.300113
##  6   AUS  6.019909
##  7   AVL  8.003831
##  8   BDL  7.048544
##  9   BGR  8.027933
## 10   BHM 16.877323
## # ... with 95 more rows</code></pre>
<pre class="r"><code># Combining
# 1. flights dataset
# 2. mutate to add &quot;madeup&quot; variable
# 3. filter it where madeup&gt;60
# 4. select particular columns

# %&gt;% as &quot;then&quot;
select(
  filter(
    mutate(flights,
      madeup=dep_delay-arr_delay
    ), madeup&gt;60
  ), dep_delay, arr_delay, dest, madeup
)</code></pre>
<pre><code>## # A tibble: 154 x 4
##    dep_delay arr_delay  dest madeup
##        &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1        -4       -65   LAX     61
##  2        65         1   OAK     64
##  3        12       -57   SFO     69
##  4        -4       -70   SFO     66
##  5       121        57   LAX     64
##  6         9       -63   LAX     72
##  7        46       -16   LAX     62
##  8        37       -25   SFO     62
##  9        -3       -68   LAS     65
## 10        31       -42   SFO     73
## # ... with 144 more rows</code></pre>
<pre class="r"><code>flights</code></pre>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code>flights %&gt;%
  mutate(madeup=dep_delay-arr_delay) %&gt;%
  filter(madeup&gt;60) %&gt;%
  select(dep_delay, arr_delay, dest, madeup)</code></pre>
<pre><code>## # A tibble: 154 x 4
##    dep_delay arr_delay  dest madeup
##        &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
##  1        -4       -65   LAX     61
##  2        65         1   OAK     64
##  3        12       -57   SFO     69
##  4        -4       -70   SFO     66
##  5       121        57   LAX     64
##  6         9       -63   LAX     72
##  7        46       -16   LAX     62
##  8        37       -25   SFO     62
##  9        -3       -68   LAS     65
## 10        31       -42   SFO     73
## # ... with 144 more rows</code></pre>
<pre class="r"><code># add a date to flights
flights</code></pre>
<pre><code>## # A tibble: 336,776 x 19
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 336,766 more rows, and 12 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code>flights &lt;- flights %&gt;%
  mutate(date=ymd(paste(year, month, day, sep=&quot;-&quot;))) %&gt;%
  na.omit()
flights</code></pre>
<pre><code>## # A tibble: 327,346 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 327,336 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, date &lt;date&gt;</code></pre>
<pre class="r"><code>flights %&gt;% select(date)</code></pre>
<pre><code>## # A tibble: 327,346 x 1
##          date
##        &lt;date&gt;
##  1 2013-01-01
##  2 2013-01-01
##  3 2013-01-01
##  4 2013-01-01
##  5 2013-01-01
##  6 2013-01-01
##  7 2013-01-01
##  8 2013-01-01
##  9 2013-01-01
## 10 2013-01-01
## # ... with 327,336 more rows</code></pre>
<pre class="r"><code>class(flights$date)</code></pre>
<pre><code>## [1] &quot;Date&quot;</code></pre>
<pre class="r"><code># How many flights departed each day?
flights %&gt;% group_by(date) %&gt;% summarize(n=n())</code></pre>
<pre><code>## # A tibble: 365 x 2
##          date     n
##        &lt;date&gt; &lt;int&gt;
##  1 2013-01-01   831
##  2 2013-01-02   928
##  3 2013-01-03   900
##  4 2013-01-04   908
##  5 2013-01-05   717
##  6 2013-01-06   829
##  7 2013-01-07   930
##  8 2013-01-08   892
##  9 2013-01-09   893
## 10 2013-01-10   929
## # ... with 355 more rows</code></pre>
<pre class="r"><code># How many each day from each origin?
flights %&gt;% group_by(date, origin) %&gt;% summarize(n=n())</code></pre>
<pre><code>## # A tibble: 1,095 x 3
## # Groups:   date [?]
##          date origin     n
##        &lt;date&gt;  &lt;chr&gt; &lt;int&gt;
##  1 2013-01-01    EWR   300
##  2 2013-01-01    JFK   295
##  3 2013-01-01    LGA   236
##  4 2013-01-02    EWR   341
##  5 2013-01-02    JFK   317
##  6 2013-01-02    LGA   270
##  7 2013-01-03    EWR   331
##  8 2013-01-03    JFK   317
##  9 2013-01-03    LGA   252
## 10 2013-01-04    EWR   337
## # ... with 1,085 more rows</code></pre>
<pre class="r"><code># how many by week by origin?
flights %&gt;% group_by(week(date), origin) %&gt;% summarize(n=n())</code></pre>
<pre><code>## # A tibble: 159 x 3
## # Groups:   week(date) [?]
##    `week(date)` origin     n
##           &lt;dbl&gt;  &lt;chr&gt; &lt;int&gt;
##  1            1    EWR  2187
##  2            1    JFK  2157
##  3            1    LGA  1699
##  4            2    EWR  2208
##  5            2    JFK  2043
##  6            2    LGA  1791
##  7            3    EWR  2170
##  8            3    JFK  1997
##  9            3    LGA  1746
## 10            4    EWR  2129
## # ... with 149 more rows</code></pre>
<pre class="r"><code># we can name a variable in the resulting tbl_df
flights %&gt;% group_by(week=week(date), origin) %&gt;% summarize(n=n())</code></pre>
<pre><code>## # A tibble: 159 x 3
## # Groups:   week [?]
##     week origin     n
##    &lt;dbl&gt;  &lt;chr&gt; &lt;int&gt;
##  1     1    EWR  2187
##  2     1    JFK  2157
##  3     1    LGA  1699
##  4     2    EWR  2208
##  5     2    JFK  2043
##  6     2    LGA  1791
##  7     3    EWR  2170
##  8     3    JFK  1997
##  9     3    LGA  1746
## 10     4    EWR  2129
## # ... with 149 more rows</code></pre>
<pre class="r"><code># let&#39;s create new data grouped by week and destination
# showing number of flights, average delays, and number distinct destinations
byweek &lt;- flights %&gt;%
  group_by(week=week(date), origin) %&gt;%
  summarize(n=n(), delay=mean(arr_delay), ndests=n_distinct(dest))
byweek</code></pre>
<pre><code>## # A tibble: 159 x 5
## # Groups:   week [?]
##     week origin     n      delay ndests
##    &lt;dbl&gt;  &lt;chr&gt; &lt;int&gt;      &lt;dbl&gt;  &lt;int&gt;
##  1     1    EWR  2187  9.0740741     82
##  2     1    JFK  2157  0.2814094     60
##  3     1    LGA  1699  1.8022366     44
##  4     2    EWR  2208  3.1077899     80
##  5     2    JFK  2043 -2.2623593     59
##  6     2    LGA  1791 -4.8330542     40
##  7     3    EWR  2170 15.0589862     80
##  8     3    JFK  1997 -1.5578368     58
##  9     3    LGA  1746  6.0337915     39
## 10     4    EWR  2129 18.7745420     80
## # ... with 149 more rows</code></pre>
<pre class="r"><code># plot number of flights by week by origin city
byweek %&gt;% ggplot(aes(week, n, colour=origin)) + geom_line()</code></pre>
<p><img src="/post/2014-09-08-kickoff-meetup-dplyr-demo_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code># why the dip at the end?
# let&#39;s get total number of flights by week
byweek %&gt;% summarize(sum(n))</code></pre>
<pre><code>## # A tibble: 53 x 2
##     week `sum(n)`
##    &lt;dbl&gt;    &lt;int&gt;
##  1     1     6043
##  2     2     6042
##  3     3     5913
##  4     4     5894
##  5     5     5803
##  6     6     5089
##  7     7     6190
##  8     8     6282
##  9     9     6315
## 10    10     6031
## # ... with 43 more rows</code></pre>
<pre class="r"><code># only 364 days in year, Dec 31 is probably day 1 of week 53
52*7</code></pre>
<pre><code>## [1] 364</code></pre>
<pre class="r"><code># same plot but not looking at week 53
byweek %&gt;%
  filter(week&lt;=52) %&gt;%
  ggplot(aes(week, n, colour=origin)) + geom_line()</code></pre>
<p><img src="/post/2014-09-08-kickoff-meetup-dplyr-demo_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
<pre class="r"><code>ymd(&quot;2013-01-01&quot;) + weeks(21) # mem day</code></pre>
<pre><code>## [1] &quot;2013-05-28&quot;</code></pre>
<pre class="r"><code>ymd(&quot;2013-01-01&quot;) + weeks(26) # july 4</code></pre>
<pre><code>## [1] &quot;2013-07-02&quot;</code></pre>
<pre class="r"><code>ymd(&quot;2013-01-01&quot;) + weeks(35) # labor day. why JFK continues decline?</code></pre>
<pre><code>## [1] &quot;2013-09-03&quot;</code></pre>
<pre class="r"><code>ymd(&quot;2013-01-01&quot;) + weeks(47) # TG, xmas, NY</code></pre>
<pre><code>## [1] &quot;2013-11-26&quot;</code></pre>
<pre class="r"><code># why JFK lose number after labor day?
# LGA added a LOT more destinations just before this decline.
# makes more people fly out of there as opposed to JFK!
byweek %&gt;%
  filter(week&lt;=52) %&gt;%
  ggplot(aes(week, ndests, colour=origin)) + geom_line()</code></pre>
<p><img src="/post/2014-09-08-kickoff-meetup-dplyr-demo_files/figure-html/unnamed-chunk-2-3.png" width="672" /></p>
<pre class="r"><code># What causes delays?
# do older planes have more delays?
flights</code></pre>
<pre><code>## # A tibble: 327,346 x 20
##     year month   day dep_time sched_dep_time dep_delay arr_time
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;    &lt;int&gt;          &lt;int&gt;     &lt;dbl&gt;    &lt;int&gt;
##  1  2013     1     1      517            515         2      830
##  2  2013     1     1      533            529         4      850
##  3  2013     1     1      542            540         2      923
##  4  2013     1     1      544            545        -1     1004
##  5  2013     1     1      554            600        -6      812
##  6  2013     1     1      554            558        -4      740
##  7  2013     1     1      555            600        -5      913
##  8  2013     1     1      557            600        -3      709
##  9  2013     1     1      557            600        -3      838
## 10  2013     1     1      558            600        -2      753
## # ... with 327,336 more rows, and 13 more variables: sched_arr_time &lt;int&gt;,
## #   arr_delay &lt;dbl&gt;, carrier &lt;chr&gt;, flight &lt;int&gt;, tailnum &lt;chr&gt;,
## #   origin &lt;chr&gt;, dest &lt;chr&gt;, air_time &lt;dbl&gt;, distance &lt;dbl&gt;, hour &lt;dbl&gt;,
## #   minute &lt;dbl&gt;, time_hour &lt;dttm&gt;, date &lt;date&gt;</code></pre>
<pre class="r"><code>planes</code></pre>
<pre><code>## # A tibble: 3,322 x 9
##    tailnum  year                    type     manufacturer     model
##      &lt;chr&gt; &lt;int&gt;                   &lt;chr&gt;            &lt;chr&gt;     &lt;chr&gt;
##  1  N10156  2004 Fixed wing multi engine          EMBRAER EMB-145XR
##  2  N102UW  1998 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  3  N103US  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  4  N104UW  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  5  N10575  2002 Fixed wing multi engine          EMBRAER EMB-145LR
##  6  N105UW  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  7  N107US  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  8  N108UW  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
##  9  N109UW  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
## 10  N110UW  1999 Fixed wing multi engine AIRBUS INDUSTRIE  A320-214
## # ... with 3,312 more rows, and 4 more variables: engines &lt;int&gt;,
## #   seats &lt;int&gt;, speed &lt;int&gt;, engine &lt;chr&gt;</code></pre>
<pre class="r"><code>flights %&gt;%
  inner_join(planes, by=&quot;tailnum&quot;) %&gt;% # explain year.x, .y
  group_by(year.y) %&gt;%
  summarize(delay=mean(arr_delay)) %&gt;%
  filter(!is.na(year.y)) %&gt;%
  ggplot(aes(year.y, delay)) + geom_point() + geom_smooth(method=&quot;loess&quot;)</code></pre>
<p><img src="/post/2014-09-08-kickoff-meetup-dplyr-demo_files/figure-html/unnamed-chunk-2-4.png" width="672" /></p>
<pre class="r"><code># what about weather?
# look at delays by month by destination
flights %&gt;%
  group_by(month, origin) %&gt;%
  summarize(delay=mean(arr_delay)) %&gt;%
  ggplot(aes(month, delay, fill=origin)) + geom_bar(stat=&quot;identity&quot;, position=&quot;dodge&quot;)</code></pre>
<p><img src="/post/2014-09-08-kickoff-meetup-dplyr-demo_files/figure-html/unnamed-chunk-2-5.png" width="672" /></p>
<pre class="r"><code># summertime delays from thunderstorms? winter delays from snow?
# let&#39;s look at precipitation
# first lets get the delay by date and origin

# how does weather affect flights?
weather</code></pre>
<pre><code>## # A tibble: 26,130 x 15
##    origin  year month   day  hour  temp  dewp humid wind_dir wind_speed
##     &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
##  1    EWR  2013     1     1     0 37.04 21.92 53.97      230   10.35702
##  2    EWR  2013     1     1     1 37.04 21.92 53.97      230   13.80936
##  3    EWR  2013     1     1     2 37.94 21.92 52.09      230   12.65858
##  4    EWR  2013     1     1     3 37.94 23.00 54.51      230   13.80936
##  5    EWR  2013     1     1     4 37.94 24.08 57.04      240   14.96014
##  6    EWR  2013     1     1     6 39.02 26.06 59.37      270   10.35702
##  7    EWR  2013     1     1     7 39.02 26.96 61.63      250    8.05546
##  8    EWR  2013     1     1     8 39.02 28.04 64.43      240   11.50780
##  9    EWR  2013     1     1     9 39.92 28.04 62.21      250   12.65858
## 10    EWR  2013     1     1    10 39.02 28.04 64.43      260   12.65858
## # ... with 26,120 more rows, and 5 more variables: wind_gust &lt;dbl&gt;,
## #   precip &lt;dbl&gt;, pressure &lt;dbl&gt;, visib &lt;dbl&gt;, time_hour &lt;dttm&gt;</code></pre>
<pre class="r"><code># create new dataset grouped by date and origin adding mean delay
delay_byday_byorigin &lt;- flights %&gt;%
  group_by(date, origin) %&gt;%
  summarize(delay=mean(arr_delay))
delay_byday_byorigin</code></pre>
<pre><code>## # A tibble: 1,095 x 3
## # Groups:   date [?]
##          date origin     delay
##        &lt;date&gt;  &lt;chr&gt;     &lt;dbl&gt;
##  1 2013-01-01    EWR 20.886667
##  2 2013-01-01    JFK  8.088136
##  3 2013-01-01    LGA  7.885593
##  4 2013-01-02    EWR 25.439883
##  5 2013-01-02    JFK  3.268139
##  6 2013-01-02    LGA  7.659259
##  7 2013-01-03    EWR  6.102719
##  8 2013-01-03    JFK  1.766562
##  9 2013-01-03    LGA 10.238095
## 10 2013-01-04    EWR  1.768546
## # ... with 1,085 more rows</code></pre>
<pre class="r"><code># Take weather data, group by YMD, summarize mean participation
# remove missing data, add date with lubridate
# join to data created last time
# plot delay by precip coloring by flight&#39;s origin, add loess
weather %&gt;% group_by(year, month, day) %&gt;%
  summarize(precip = mean(precip)) %&gt;%
  na.omit() %&gt;%
  mutate(date=ymd(paste(year, month, day, sep=&quot;-&quot;))) %&gt;%
  inner_join(delay_byday_byorigin, by=&quot;date&quot;) %&gt;%
  ggplot(aes(precip, delay, col=origin)) + geom_point() + geom_smooth()</code></pre>
<pre><code>## `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : pseudoinverse used at -0.00013056</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : neighborhood radius 0.00054722</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : reciprocal condition number 0</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : There are other near singularities as well. 1.7361e-07</code></pre>
<pre><code>## Warning in predLoess(object$y, object$x, newx = if
## (is.null(newdata)) object$x else if (is.data.frame(newdata))
## as.matrix(model.frame(delete.response(terms(object)), : pseudoinverse used
## at -0.00013056</code></pre>
<pre><code>## Warning in predLoess(object$y, object$x, newx = if
## (is.null(newdata)) object$x else if (is.data.frame(newdata))
## as.matrix(model.frame(delete.response(terms(object)), : neighborhood radius
## 0.00054722</code></pre>
<pre><code>## Warning in predLoess(object$y, object$x, newx = if
## (is.null(newdata)) object$x else if (is.data.frame(newdata))
## as.matrix(model.frame(delete.response(terms(object)), : reciprocal
## condition number 0</code></pre>
<pre><code>## Warning in predLoess(object$y, object$x, newx = if
## (is.null(newdata)) object$x else if (is.data.frame(newdata))
## as.matrix(model.frame(delete.response(terms(object)), : There are other
## near singularities as well. 1.7361e-07</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : at -0.00012361</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : radius 1.528e-08</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : all data on boundary of neighborhood. make span bigger</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : pseudoinverse used at -0.00012361</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : neighborhood radius 0.00012361</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : reciprocal condition number 1</code></pre>
<pre><code>## Warning in simpleLoess(y, x, w, span, degree = degree, parametric =
## parametric, : zero-width neighborhood. make span bigger</code></pre>
<pre><code>## Warning: Computation failed in `stat_smooth()`:
## NA/NaN/Inf in foreign function call (arg 5)</code></pre>
<p><img src="/post/2014-09-08-kickoff-meetup-dplyr-demo_files/figure-html/unnamed-chunk-2-6.png" width="672" /></p>
<pre class="r"><code># Is the average delay related to the average distance flown by a plane?
flights %&gt;% group_by(tailnum) %&gt;%
  summarize(dist=mean(distance), delay=mean(arr_delay), count=n()) %&gt;%
  ggplot(aes(dist, delay)) + geom_point(aes(size=count), alpha=1/2) + scale_size_area()</code></pre>
<p><img src="/post/2014-09-08-kickoff-meetup-dplyr-demo_files/figure-html/unnamed-chunk-2-7.png" width="672" /></p>


  
<div class="prev-next-post pure-g">
  <div class="pure-u-1-24" style="text-align: left;">
    
    <a href="/post/texreg-converting-model-output-to-latex-or-html/"><i class="fa fa-chevron-left"></i></a>
    
  </div>
  <div class="pure-u-10-24">
    
    <nav class="prev">
      <a href="/post/texreg-converting-model-output-to-latex-or-html/">texreg: converting model output to Latex or HTML</a>
    </nav>
    
  </div>
  <div class="pure-u-2-24">
    &nbsp;
  </div>
  <div class="pure-u-10-24">
    
    <nav class="next">
      <a href="/post/web-scraping/">Web Scraping</a>
    </nav>
    
  </div>
  <div class="pure-u-1-24" style="text-align: right;">
    
    <a href="/post/web-scraping/"><i class="fa fa-chevron-right"></i></a>
    
  </div>
</div>



  

</div>

</div>
</div>
<script src="/js/ui.js"></script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'Your Google Analytics tracking ID', 'auto');
  ga('send', 'pageview');

</script>





</body>
</html>

